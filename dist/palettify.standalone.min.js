/*!
 * palettify v0.0.0 
 * (c) 2017 Dobromir Hristov
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@mariotacke/color-thief")):"function"==typeof define&&define.amd?define(["@mariotacke/color-thief"],e):t.palettify=e(t.colorThief)}(this,function(t){"use strict";function e(t){switch(typeof t){case"string":case"number":case"boolean":return t;case"object":try{return null===t?"":JSON.stringify(t)}catch(t){return"{...}"}default:return""}}function n(t,e,a){if(void 0===a&&(a=0),"object"!=typeof t||null===t||void 0===t)return"";var r=e[a],o=t[r];return a===e.length-1?o:n(o,e,++a)}function a(t,e){return n(e,t.split("."))}function r(t,n,r){return void 0===n&&(n={}),void 0===r&&(r=a),"string"!=typeof t?t:t.replace(i,function(t,o){try{return e(r(o,n))}catch(t){return e(a(o,n))}})}function o(){function e(e,n){var a=d(e);return new Promise(function(e){y(a)?e((new t).getPalette(a,n)):a.onload=function(){e((new t).getPalette(a,n))}})}function n(t,e){return t.map(function(t,n){var r=1;return Array.isArray(e)&&e[n]&&(r=e[n]),a(t,r)})}function a(t,e){return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function r(t,e,n,a){void 0===a&&(a=null);for(var r in e)e.hasOwnProperty(r)&&(t.style[r]=s(e[r],n));a&&a.call(t,t,e,n)}function o(t,e,n,a){for(var r in e)e.hasOwnProperty(r)&&!n.hasOwnProperty(r)?t.style[r]="":n.hasOwnProperty(r)&&(t.style[r]=s(n[r],a))}function i(t){E.options=Object.assign({},h,t),Object.keys(E.options).forEach(function(t){if(E.options[t]instanceof Error)throw E.options[t]})}function l(t){return(299*t[0]+587*t[1]+114*t[2])/1e3}function c(t){return l(t)<128}function u(t,e){return t.map(function(t){return c(t)?e.light:e.dark})}function f(t){var e=document.createElement("a");return e.href=t,e}function p(t){return document.location.host!==f(t.src).host}function y(t){return!!t.complete&&(void 0===t.naturalWidth||0!==t.naturalWidth)}function d(t){var e=t,n=p(e),a="IMG"!==e.tagName;if(!e)throw Error("Target is not an element",e);if(a||n&&!e.crossOrigin){if(a&&!e.style.backgroundImage)throw Error("Tag provided is not an image and does not have a background-image style attached to it.");e=new Image(t.offsetWidth,t.offsetHeight),n&&(e.crossOrigin="anonymous"),e.src=a?t.style.backgroundImage.replace("url(","").replace(")","").replace(/"/gi,""):t.src}return e}var v=!1,g=null,h={selector:Error("Please provide \u0430 selector in your options."),eventTarget:Error("Please provide an eventTarget as a parent for your image in the options."),image:Error("Please provide an image to sample."),styleTarget:null,opacities:[.5,.5,.5],contrastColors:{light:"#fff",dark:"#000"},activeClass:"palettify--active",readyClass:"palettify--ready",colorsToExtract:3,enterEvent:"mouseenter",leaveEvent:"mouseleave",staticStyles:{},dynamicStyles:{},staticCallback:null,beforeEnterCallback:null,afterEnterCallback:null,beforeLeaveCallback:null,afterLeaveCallback:null,onReadyCallback:null},E={options:{},data:[],collectElements:function(){var t="";(g="string"==typeof E.options.selector?document.querySelector(E.options.selector):E.options.selector)&&(t=g.querySelectorAll(E.options.eventTarget),[].slice.call(t,0).forEach(function(t){var e=t.querySelector(E.options.image),n=t.querySelector(E.options.styleTarget||E.options.image),a={eventTarget:t,styleTarget:n,image:e,palette:{original:[],rgb:[],rgba:[]}};E.data.push(a)}))},extractColorsAndAttachStyles:function(){var t=[];E.data.forEach(function(a,o){t[o]=e(a.image,E.options.colorsToExtract).then(function(t){a.palette.original=t,a.palette.rgb=n(a.palette.original,[]),a.palette.rgba=n(a.palette.original,E.options.opacities),a.palette.contrastColors=u(a.palette.original,E.options.contrastColors),r(a.styleTarget,E.options.staticStyles,a.palette,E.options.staticCallback)})}),Promise.all(t).then(function(t){g.classList.add(E.options.readyClass)})},generateEnterHandler:function(t){return function(e){t.styleTarget&&("function"==typeof E.options.beforeEnterCallback&&E.options.beforeEnterCallback.call(t.styleTarget,t.palette,e,E.options),t.styleTarget.classList.add(E.options.activeClass),r(t.styleTarget,E.options.dynamicStyles,t.palette),"function"==typeof E.options.afterEnterCallback&&E.options.afterEnterCallback.call(t.styleTarget,t.palette,e,E.options))}},generateLeaveHandler:function(t){return function(e){var n=t.styleTarget;n&&(E.options.beforeLeaveCallback&&E.options.beforeLeaveCallback.call(t.styleTarget,t.palette,e,E.options),n.classList.remove(E.options.activeClass),o(t.styleTarget,E.options.dynamicStyles,E.options.staticStyles,t.palette),E.options.afterLeaveCallback&&E.options.afterLeaveCallback.call(t.styleTarget,t.palette,e,E.options))}},attachEventListeners:function(){var t=E.options,e=t.enterEvent,n=t.leaveEvent;e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n],E.data.forEach(function(t){t.enterHandler=E.generateEnterHandler(t),t.leaveHandler=E.generateLeaveHandler(t),e.forEach(function(e){t.eventTarget.addEventListener(e,t.enterHandler,!1)}),n.forEach(function(e){t.eventTarget.addEventListener(e,t.leaveHandler,!1)})})},detachEventListeners:function(){var t=E.options,e=t.enterEvent,n=t.leaveEvent;e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n],E.data.forEach(function(t){e.forEach(function(e){t.eventTarget.removeEventListener(e,t.enterHandler,!1)}),n.forEach(function(e){t.eventTarget.removeEventListener(e,t.leaveHandler,!1)})})},init:function(t){if(v)throw new Error("Palettify is already initialized");return i(t),E.collectElements(),E.extractColorsAndAttachStyles(),E.attachEventListeners(),v=!0,"function"==typeof E.options.onReadyCallback&&E.options.onReadyCallback.call(E,E),E},destroy:function(t){void 0===t&&(t=!0),E.detachEventListeners(),t&&E.cleanUp(),E.data=[],v=!1},reInit:function(){E.destroy(),E.init(E.options)},cleanUp:function(){E.data.forEach(function(t){for(var e in E.options.staticStyles)E.options.staticStyles.hasOwnProperty(e)&&(t.styleTarget.style[e]="")})},setOptions:function(t,e){void 0===e&&(e=!0),E.options=Object.assign({},E.options,t),e&&E.reInit()},isInitialized:function(){return v}};return E}t="default"in t?t.default:t;var i=/\{\{\s*(.*?)\s*\}\}/g,l=r,s=l;return o});