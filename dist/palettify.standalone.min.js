/*!
 * palettify v0.0.0 
 * (c) 2017 Dobromir Hristov
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@mariotacke/color-thief")):"function"==typeof define&&define.amd?define(["@mariotacke/color-thief"],t):e.palettify=t(e.colorThief)}(this,function(e){"use strict";function t(e){switch(typeof e){case"string":case"number":case"boolean":return e;case"object":try{return null===e?"":JSON.stringify(e)}catch(e){return"{...}"}default:return""}}function n(e,t,a){if(void 0===a&&(a=0),"object"!=typeof e||null===e||void 0===e)return"";var r=t[a],o=e[r];return a===t.length-1?o:n(o,t,++a)}function a(e,t){return n(t,e.split("."))}function r(e,n,r){return void 0===n&&(n={}),void 0===r&&(r=a),"string"!=typeof e?e:e.replace(i,function(e,o){try{return t(r(o,n))}catch(e){return t(a(o,n))}})}function o(){function t(t,n){var a=t;if(!t)throw Error("Target is not an element",t);if("IMG"!==t.tagName){if(!t.style.backgroundImage)throw Error("Tag provided is not an image and does not have a background-image style attached to it.");a=new Image(t.offsetWidth,t.offsetHeight),a.src=t.style.backgroundImage.replace("url(","").replace(")","").replace(/"/gi,"")}return(new e).getPalette(a,n)}function n(e,t){return e.map(function(e,n){var r=1;return Array.isArray(t)&&t[n]&&(r=t[n]),a(e,r)})}function a(e,t){return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+t+")"}function r(e,t,n,a){void 0===a&&(a=null);for(var r in t)t.hasOwnProperty(r)&&(e.style[r]=s(t[r],n));a&&a.call(e,e,t,n)}function o(e,t,n,a){for(var r in t)t.hasOwnProperty(r)&&!n.hasOwnProperty(r)?e.style[r]="":n.hasOwnProperty(r)&&(e.style[r]=s(n[r],a))}function i(e){d.options=Object.assign({},y,e),Object.keys(d.options).forEach(function(e){if(d.options[e]instanceof Error)throw d.options[e]})}function l(e){return(299*e[0]+587*e[1]+114*e[2])/1e3}function c(e){return l(e)<128}function f(e,t){return e.map(function(e){return c(e)?t.light:t.dark})}var u=!1,p=null,y={selector:Error("Please provide \u0430 selector in your options."),eventTarget:Error("Please provide an eventTarget as a parent for your image in the options."),image:Error("Please provide an image to sample."),styleTarget:null,opacities:[.5,.5,.5],contrastColors:{light:"#fff",dark:"#000"},activeClass:"palettify--active",readyClass:"palettify--ready",colorsToExtract:3,enterEvent:"mouseenter",leaveEvent:"mouseleave",staticStyles:{},dynamicStyles:{},staticCallback:null,beforeEnterCallback:null,afterEnterCallback:null,beforeLeaveCallback:null,afterLeaveCallback:null,onReadyCallback:null},d={options:{},data:[],collectElements:function(){var e="";(p="string"==typeof d.options.selector?document.querySelector(d.options.selector):d.options.selector)&&(e=p.querySelectorAll(d.options.eventTarget),[].slice.call(e,0).forEach(function(e){var t=e.querySelector(d.options.image),n=e.querySelector(d.options.styleTarget||d.options.image),a={eventTarget:e,styleTarget:n,image:t,palette:{original:[],rgb:[],rgba:[]}};d.data.push(a)}))},extractColorsAndAttachStyles:function(){d.data.forEach(function(e){e.palette.original=t(e.image,d.options.colorsToExtract),e.palette.rgb=n(e.palette.original,[]),e.palette.rgba=n(e.palette.original,d.options.opacities),e.palette.contrastColors=f(e.palette.original,d.options.contrastColors),r(e.styleTarget,d.options.staticStyles,e.palette,d.options.staticCallback)}),p.classList.add(d.options.readyClass)},generateEnterHandler:function(e){return function(t){e.styleTarget&&("function"==typeof d.options.beforeEnterCallback&&d.options.beforeEnterCallback.call(e.styleTarget,e.palette,t,d.options),e.styleTarget.classList.add(d.options.activeClass),r(e.styleTarget,d.options.dynamicStyles,e.palette),"function"==typeof d.options.afterEnterCallback&&d.options.afterEnterCallback.call(e.styleTarget,e.palette,t,d.options))}},generateLeaveHandler:function(e){return function(t){var n=e.styleTarget;n&&(d.options.beforeLeaveCallback&&d.options.beforeLeaveCallback.call(e.styleTarget,e.palette,t,d.options),n.classList.remove(d.options.activeClass),o(e.styleTarget,d.options.dynamicStyles,d.options.staticStyles,e.palette),d.options.afterLeaveCallback&&d.options.afterLeaveCallback.call(e.styleTarget,e.palette,t,d.options))}},attachEventListeners:function(){var e=d.options,t=e.enterEvent,n=e.leaveEvent;t=Array.isArray(t)?t:[t],n=Array.isArray(n)?n:[n],d.data.forEach(function(e){e.enterHandler=d.generateEnterHandler(e),e.leaveHandler=d.generateLeaveHandler(e),t.forEach(function(t){e.eventTarget.addEventListener(t,e.enterHandler,!1)}),n.forEach(function(t){e.eventTarget.addEventListener(t,e.leaveHandler,!1)})})},detachEventListeners:function(){var e=d.options,t=e.enterEvent,n=e.leaveEvent;t=Array.isArray(t)?t:[t],n=Array.isArray(n)?n:[n],d.data.forEach(function(e){t.forEach(function(t){e.eventTarget.removeEventListener(t,e.enterHandler,!1)}),n.forEach(function(t){e.eventTarget.removeEventListener(t,e.leaveHandler,!1)})})},init:function(e){if(u)throw new Error("Palettify is already initialized");return i(e),d.collectElements(),d.extractColorsAndAttachStyles(),d.attachEventListeners(),u=!0,"function"==typeof d.options.onReadyCallback&&d.options.onReadyCallback.call(d,d),d},destroy:function(e){void 0===e&&(e=!0),d.detachEventListeners(),e&&d.cleanUp(),d.data=[],u=!1},reInit:function(){d.destroy(),d.init(d.options)},cleanUp:function(){d.data.forEach(function(e){for(var t in d.options.staticStyles)d.options.staticStyles.hasOwnProperty(t)&&(e.styleTarget.style[t]="")})},setOptions:function(e,t){void 0===t&&(t=!0),d.options=Object.assign({},d.options,e),t&&d.reInit()},isInitialized:function(){return u}};return d}e="default"in e?e.default:e;var i=/\{\{\s*(.*?)\s*\}\}/g,l=r,s=l;return o});